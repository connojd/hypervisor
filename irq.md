**NOTE**: These changes will be made to the
[extended_apis](https://github.com/Bareflank/extended_apis) and not the main
Bareflank repo as we want to keep Bareflank simple. This RFC proposes
modifications of the current event API (as specified in RFC #424) and
clarifies the scope and intent of the API.

## Background
The current event API exposes a set of functions that enables "events" to be
injected into VMs. Section 24.8.3 of the Intel SDM specifies six types of
events that a VMM may inject (numbering mine):

1. External interrupts (IRQs)
2. Nonmaskable interrupts (NMIs)
3. Hardware exceptions
4. Software exceptions
4. Software interrupts
4. Other (not delivered through the guest IDT)

These types have different contextual information associated with them e.g.
a hardware exception may or may not have an error code whereas an interrupt
never has an error code, unless of course it is a software interrupt (i.e.
generated by the `int n` instruction). The events with the "Other" type
are specific to the VT-x implementation; currently only the "monitor trap"
event is available, but new events may be added in the future.

The list of event types is sorted according to the approximate relevance of
the hardware resources they represent. The VMM has ultimate ownership of these
physical resources and as such can decide how they are managed.  For example,
a VMM may delegate management of I/O devices to VMs by disabling
external-interrupt exiting. If the VMM wants to manage them, it could enable
external-interrupt exiting or use VT-d if it's supported. In general, the set
of features available to the VMM depends on the platform and is constantly
evolving.

## Proposed Changes
Because the extended APIs should remain flexible to clients' needs, and
because those needs will evolve as virtualization extensions evolve, I propose
that a new `event_manager` class is created. This will provide the flexibility
needed to add support for new architectural features and will keep the event
management code (of which there will be *alot*) separate from other modules.

## Proposed APIs

**Public Functions**
```cpp

// This function will be invoked by clients that need event management
// service. The default behavior will check the type of the event and then
// dispatch type-specific management code. The only type supported by the
// default implementation will be external interrupts.
virtual event_manager::manage_event(event e);

// This function sends the supplied event to its destination, which
// is specified in an implementation-defined manner. This allows
// for complex addressing modes if needed (e.g. we want to send
// an interrupt to a domain of VMs or physical cores).
//
virtual event_manager::send_event(event e);

// This function is used to delegate management of events
// to either the VM or the VMM.
virtual event_manager::delegate_event_mgmt(event e);
```

**Register vmcalls**
delegate_event_mgmt: Request to delegate event management of the specified type
to the specified manager. The default delegate is the VM
  - r2 = eapis_cat__event_mgmt` (0x6000)
  - r3 = eapis_cat__delegate_event_mgmt` (0x1)
  - r4 = type (0 -> external_interrupts)
  - r5 = manager (0 -> VMM, 1 -> VM)
  - Default policy:
    | r4 | r5 | policy |
    | 0  | 0  | grant  |
    | 0  | 1  | grant  |
    | other | other | deny |

**JSON vmcalls**


